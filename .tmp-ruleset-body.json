{"source":{"files":[{"name":"firestore.rules","content":"\r\nrules_version = '2';\r\nservice cloud.firestore {\r\n  match /databases/{database}/documents {\r\n\r\n    /**\n     * FIRESTORE SECURITY RULES\n     * \n     * Core Philosophy:\n     * - User data is private and ownership-based.\n     * - Global cache is server-managed only (no client access).\n     */\n\r\n    function isSignedIn() {\r\n      return request.auth != null;\r\n    }\r\n\r\n    function isOwner(userId) {\r\n      return isSignedIn() && request.auth.uid == userId;\r\n    }\r\n\r\n    match /users/{userId}/studyGuides/{studyGuideId} {\r\n      allow get, list: if isOwner(userId);\r\n      allow create: if isOwner(userId) && request.resource.data.userId == userId;\r\n      allow update: if isOwner(userId) && request.resource.data.userId == resource.data.userId;\r\n      allow delete: if isOwner(userId);\r\n\r\n      match /textChunks/{textChunkId} {\r\n        allow get, list: if isOwner(userId);\r\n        allow create: if isOwner(userId) && request.resource.data.userId == userId;\r\n        allow update: if isOwner(userId) && request.resource.data.userId == resource.data.userId;\r\n        allow delete: if isOwner(userId);\r\n      }\r\n    }\r\n\r\n    match /explanationCacheEntries/{explanationCacheEntryId} {\n      // Global cache is managed by server/admin only.\n      // Client SDK has no direct read/write access.\n      allow get, list, create, update, delete: if false;\n    }\n\n    match /canonicalStudyGuides/{canonicalGuideId} {\n      // Canonical cross-user guide cache is server/admin only.\n      allow get, list, create, update, delete: if false;\n\n      match /chunks/{chunkId} {\n        allow get, list, create, update, delete: if false;\n      }\n    }\n\n    match /{path=**} {\n      allow read, write: if false;\n    }\n  }\n}\r\n"}]}}